<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: helper.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: helper.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>function _SendMsg(msg, src) {
  console.log("sent");
  chrome.runtime.sendMessage({
    msg: msg,
    data: {
      screen: src,
      option: src,
    },
  });
}

function _StorageStruct(pw) {
  let struct = {
    currAcc: -1,
    accList: [],
    walletpw: pw,
    tnm: {},
    txbuf: [],
  };

  return struct;
}

function _CreateAccountRecord(name, address) {
  let oneAcc = {
    name: name,
    address: address,
    balance: [],
    history: [],
  };
  return oneAcc;
}

function _CheckDuplicate(address) {}

/*
function _PutStorage(accountObj, isFirst) {
  console.log("putstorage came in");
  chrome.storage.sync.get(null, function (obj) {

    let name = "";
    if (isFirst) name = "AccountCreatedAt_"+_GetTime();
    else name = "AccountLoadedAt_"+_GetTime();

    const address = accountObj.address;

    obj["currAcc"]["address"] = address;
    obj["currAcc"]["name"] = name;
    
    console.log(obj);

    let idx = obj["accList"].length
    let toPush = _CreateAccountRecord(name, address)
    obj["accList"].push(toPush);

    chrome.storage.sync.set(obj, function () {
      console.log("Saved");
      console.log(obj);
    });
  });
}
*/

function _PutStorage(accountObj, isFirst) {
  console.log("putstorage came in");
  chrome.storage.sync.get(null, function (obj) {
    let name = "";
    if (isFirst) name = "AccountCreatedAt_" + _GetTime();
    else name = "AccountLoadedAt_" + _GetTime();
    const address = accountObj.address;

    let toPush = _CreateAccountRecord(name, address);
    obj["accList"].push(toPush);
    obj["currAcc"] = obj["accList"].length - 1;

    chrome.storage.sync.set(obj, function () {
      console.log("Saved");
      console.log(obj);
    });
  });
}

async function _GetBalance(accountAddress) {
  const getbalance = await web3.eth.getBalance(accountAddress);
  const ethBal = String(web3.utils.fromWei(getbalance, "ether"));
  return ethBal;
}

async function _CheckTxStatus(txHash) {
  const status = await web3.eth.getTransactionReceipt(txHash);
  let res;
  try {
    res = status.status; // TODO: Null exception
    if (res == true) res = 1;
    if (res == false) res = 0;
  } catch (ex) {
    res = -1;
  }
  return res;
}

async function _GetCurr() {
  return new Promise((resolve, reject) => {
    try {
      chrome.storage.sync.get(null, function (res) {
        // console.log(res);
        let idx = res["currAcc"];
        resolve(res["accList"][idx]);
      });
    } catch (ex) {
      reject(ex);
    }
  });
}

async function _GetAll() {
  return new Promise((resolve, reject) => {
    try {
      chrome.storage.sync.get(null, function (res) {
        resolve(res);
      });
    } catch (ex) {
      reject(ex);
    }
  });
}

async function _GetList() {
  return new Promise((resolve, reject) => {
    try {
      chrome.storage.sync.get(null, function (res) {
        resolve(res["accList"]);
      });
    } catch (ex) {
      reject(ex);
    }
  });
}

async function _GetWalletPW() {
  return new Promise((resolve, reject) => {
    try {
      chrome.storage.sync.get(null, function (res) {
        resolve(res["walletpw"]);
      });
    } catch (ex) {
      reject(ex);
    }
  });
}

async function _CheckPw(pw) {
  const inputPw = await _sha256(pw);
  const correctPw = await _GetWalletPW();
  if (inputPw == correctPw) return true;
  else return false;
}

// function _GetAddress() {
//   let add;
//   chrome.storage.sync.get(null, function (res) {
//     add = res["currAcc"]["address"];
//   });
//   return add;
//   // let a = chrome.storage.sync.get(null, _test(res));
//   // console.log(a);
//   // return add;
// }

function _GetTime() {
  var today = new Date();
  var date =
    today.getFullYear() +
    "" +
    (today.getMonth() + 1) +
    "" +
    today.getDate() +
    "" +
    today.getHours() +
    "" +
    today.getMinutes();
  return date;
}

function _SaveWalletWeb3js() {
  chrome.storage.sync.get(null, function (obj) {
    pw = obj["walletpw"];
    web3.eth.accounts.wallet.load(pw); // [CAUTION] SHOULD BE LOADED RIGHT BEFORE SAVING
    web3.eth.accounts.wallet.save(pw);
    console.log(web3.eth.accounts.wallet.load(pw));

    console.log("created/loaded account was saved");
  });
}

async function _GetWalletObj(pw) {
  pw = await _sha256(pw);
  const walletobj = web3.eth.accounts.wallet.load(pw);
  console.log(walletobj);
  return walletobj;
}
function _TxBufferStruct(txType, currencyType, txHash, from, to, amount, time) {
  console.log("instruct -> " + amount);
  let txRecord = {
    txStatus: -1, // -1 Pending   0 Rejected    1 Accepted
    txType: txType,
    currencyType: currencyType,
    txHash: txHash,
    from: from,
    to: to,
    amount: amount,
    time: time,
  };
  return txRecord;
}

function _TxBufferPush(txbufferstruct) {
  chrome.storage.sync.get(null, function (obj) {
    obj["txbuf"].push(txbufferstruct);
    chrome.storage.sync.set(obj, function () {
      console.log("Saved");
      console.log(obj);
    });
  });
}

function _GetTimeSec() {
  var today = new Date();
  var date =
    today.getFullYear() + "-" + (today.getMonth() + 1) + "-" + today.getDate();
  var time =
    today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
  var dateTime = date + " " + time;
  return dateTime;
}

function _ValidateAdd(address) {
  if (address.length == 42) {
    if (address[0] == "0" &amp;&amp; address[1] == "x") {
      if (_isAlnum(address)) {
        return address;
      }
    }
  }
  if (address.length == 40) {
    if (address[0] != "0" &amp;&amp; address[1] != "x") {
      if (_isAlnum(address)) {
        return "0x" + address;
      }
    }
  }
  return "fail";
}

function _ValidatePk(pk) {
  console.log(pk.length);
  if (pk.length == 66) {
    if (pk[0] == "0" &amp;&amp; pk[1] == "x") {
      if (_isAlnum(pk)) {
        return pk;
      }
    }
  }
  if (pk.length == 64) {
    if (pk[0] != "0" &amp;&amp; pk[1] != "x") {
      console.log("camehere");
      if (_isAlnum(pk)) {
        return "0x" + pk;
      }
    }
  }
  return "fail";
}

function _isAlnum(str) {
  var code, i, len;

  for (i = 0, len = str.length; i &lt; len; i++) {
    code = str.charCodeAt(i);
    if (
      !(code > 47 &amp;&amp; code &lt; 58) &amp;&amp; // numeric (0-9)
      !(code > 64 &amp;&amp; code &lt; 91) &amp;&amp; // upper alpha (A-Z)
      !(code > 96 &amp;&amp; code &lt; 123)
    ) {
      // if (code == )
      return false;
    }
  }
  return true;
}
async function _GetAvgGasPrice() {
  let gasprice = await web3.eth.getGasPrice();
  return gasprice;
}

/**
 * @async
 * @function _GetTokenAddress
 * @param  {string} currency
 */
async function _GetTokenAddress(currency) {
  const curr = await _GetCurr();
  const tokList = curr["balance"];
  let tokAddress = "";
  for (let eachTokList of tokList) {
    if (eachTokList[0] == currency) {
      tokAddress = eachTokList[3];
      break;
    }
  }
  return tokAddress;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#_GetBalance_EtherAndToken">_GetBalance_EtherAndToken</a></li><li><a href="global.html#_GetTokenAddress">_GetTokenAddress</a></li><li><a href="global.html#_sha256">_sha256</a></li><li><a href="global.html#AccountDetail">AccountDetail</a></li><li><a href="global.html#AccountTransition">AccountTransition</a></li><li><a href="global.html#AddOptionsForAccountTransition">AddOptionsForAccountTransition</a></li><li><a href="global.html#AddOptionsForSend">AddOptionsForSend</a></li><li><a href="global.html#ChangeName">ChangeName</a></li><li><a href="global.html#CreateAccount">CreateAccount</a></li><li><a href="global.html#GoHome">GoHome</a></li><li><a href="global.html#LoadAccount">LoadAccount</a></li><li><a href="global.html#LoadWallet">LoadWallet</a></li><li><a href="global.html#MakeAndSaveWallet">MakeAndSaveWallet</a></li><li><a href="global.html#SendTok">SendTok</a></li><li><a href="global.html#SendTx">SendTx</a></li><li><a href="global.html#ValidateSendInfo_Ether">ValidateSendInfo_Ether</a></li><li><a href="global.html#ValidateSendInfo_Token">ValidateSendInfo_Token</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Fri Feb 18 2022 13:28:10 GMT+0900 (Korean Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
